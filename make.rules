include ../make.config

CC_X86=g++

OPT?=-O2

#-fno-tree-vectorize
CFLAGS+=${OPT} -fno-unroll-loops -fno-peel-loops -I ../

PCM_DIR=../../pcm
PCM+= -I ${PCM_DIR} -L ${PCM_DIR}/cpucounters.o ${PCM_DIR}/pci.o ${PCM_DIR}/msr.o ${PCM_DIR}/client_bw.o ${PCM_DIR}/cpucounters.o ${PCM_DIR}/mmio.o

default: benchX86

all: benchX86

ifneq ("$(wildcard rand_arr_args.txt)","")
args := $(shell cat rand_arr_args.txt)

randArr.h: rand_arr_args.txt
	${PY} ../rand_c_arr.py $(args)

pre_req: randArr.h
else
pre_req:
endif

benchX86: bench.cpp pre_req
	${CC_X86} ${CFLAGS} -std=c++11 ${PCM} -lpthread bench.cpp -o bench.X86

clean:
	rm -f bench.X86